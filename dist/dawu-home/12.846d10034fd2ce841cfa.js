(window.webpackJsonp=window.webpackJsonp||[]).push([[12],{"8oDX":function(e,n,t){"use strict";t.r(n);var o=t("CcnG"),r=function(){return function(){}}(),i=t("Vxrp"),a=t("pMnS"),c=t("6+7j"),l=t("sjqh"),s=t("nPNc"),u=t("s/lM"),d=t("+J3Q"),g=t("LvDl"),h=t("5tJd"),f=function(){function e(){this.filterStr="",this.selectedImageSourceIdChange=new o.n,this.fileGroup=h.b.createWithRoot("ROOT"),this.rootFileId="ROOT"}return e.prototype.ngOnChanges=function(e){e.imageSources&&this.onImageSourcesChanges(this.imageSources),e.selectedImageSourceId&&(this.selectedImageSourceIds=this.selectedImageSourceId?new Set([this.selectedImageSourceId]):new Set)},e.prototype.onImageSourcesChanges=function(e){var n=Object(g.map)(e,(function(e){return Object.assign(new h.a,{id:e.id,label:e.label||e.id})}));this.fileGroup.setRootChildren(n)},e.prototype.onSelectedFileIdsChange=function(e){var n=Array.from(e||[])[0];this.selectedImageSourceIdChange.emit(n)},e}(),p=o.qb({encapsulation:0,styles:[["[_nghost-%COMP%]{height:100%;width:100%}[_nghost-%COMP%]   dwu-file-explorer[_ngcontent-%COMP%]{display:flex;height:100%;width:100%}"]],data:{}});function b(e){return o.Nb(0,[(e()(),o.sb(0,0,null,null,2,"dwu-file-explorer",[],null,[[null,"filesByIdChange"],[null,"closedFileIdsChange"],[null,"selectedFileIdsChange"]],(function(e,n,t){var o=!0,r=e.component;return"filesByIdChange"===n&&(o=!1!==(r.fileGroup.filesById=t)&&o),"closedFileIdsChange"===n&&(o=!1!==r.fileGroup.setClosedFileIds(t)&&o),"selectedFileIdsChange"===n&&(o=!1!==r.onSelectedFileIdsChange(t)&&o),o}),s.b,s.a)),o.Ib(512,null,u.c,u.c,[[2,u.d]]),o.rb(2,4898816,null,0,d.a,[u.c,o.k],{rootFileId:[0,"rootFileId"],fuzzFilterString:[1,"fuzzFilterString"],filesById:[2,"filesById"],closedFileIds:[3,"closedFileIds"],selectedFileIds:[4,"selectedFileIds"],perfMode:[5,"perfMode"]},{filesByIdChange:"filesByIdChange",closedFileIdsChange:"closedFileIdsChange",selectedFileIdsChange:"selectedFileIdsChange"})],(function(e,n){var t=n.component;e(n,2,0,t.fileGroup.rootFileId,t.filterStr,t.fileGroup.filesById,t.fileGroup.closedFileIds,t.selectedImageSourceIds,!0)}),null)}var C=t("Ip0R"),O=t("ZYCi"),_=t("yGQT"),m=t("ssbT"),M=t("YZbJ"),P=function(){function e(e,n,t){this.store=e,this.router=n,this.activatedRoute=t,this.filterStr="",this.leftSideExpanded=!1,this.user$=this.store.pipe(Object(_.B)(M.d)),this.imageSourcesList$=this.store.pipe(Object(_.B)(m.c)),this.selectedImageSourceId$=this.store.pipe(Object(_.B)(m.g))}return e.prototype.ngOnInit=function(){var e=this;this.store.dispatch(m.a.setImageSourcesListVisible({payload:!0})),this.sub=this.activatedRoute.params.subscribe((function(n){e.store.dispatch(m.a.setSelectedImageSourceId({payload:n.imageSourceId}))}))},e.prototype.ngOnDestroy=function(){this.store.dispatch(m.a.setImageSourcesListVisible({payload:!1})),this.sub&&this.sub.unsubscribe()},e.prototype.onCreateSource=function(){this.store.dispatch(m.a.createImageSource())},e.prototype.onSelectedImageSourceIdChange=function(e){var n=this.router.createUrlTree([e],{relativeTo:this.activatedRoute});this.store.dispatch(m.a.navigateToImageSourceView({payload:n.toString()}))},e}(),I=o.qb({encapsulation:0,styles:[["[_nghost-%COMP%]{display:block;height:100%;width:100%}@media screen and (max-width:750px){[_nghost-%COMP%]   div.page-container[_ngcontent-%COMP%]{flex-direction:column}[_nghost-%COMP%]   div.page-container[_ngcontent-%COMP%]   .left-side[_ngcontent-%COMP%]{box-shadow:2px 2px 4px 0 #9d9b99;flex:0 0 auto;height:13.25rem;width:100%;max-width:none;transition:height 50ms}[_nghost-%COMP%]   div.page-container[_ngcontent-%COMP%]   .left-side.expanded[_ngcontent-%COMP%]{height:75%}[_nghost-%COMP%]   div.page-container[_ngcontent-%COMP%]   .left-side[_ngcontent-%COMP%]   .expander[_ngcontent-%COMP%]{background-color:#3f4038;color:#fcfcf9;position:absolute;bottom:0;left:50%;transform:translateX(-50%);width:3.5rem;height:1rem;border:1px solid #8a9a5b;border-radius:5px 5px 0 0;text-align:center;display:flex;justify-content:center;cursor:pointer}[_nghost-%COMP%]   div.page-container[_ngcontent-%COMP%]   .left-side[_ngcontent-%COMP%]   .expander[_ngcontent-%COMP%]:hover:not([disabled]){background-color:#4b5320;color:#fcfcf9}[_nghost-%COMP%]   div.page-container[_ngcontent-%COMP%]   .left-side[_ngcontent-%COMP%]   .expander.active[_ngcontent-%COMP%]:not([disabled]){background-color:#708238;color:#fcfcf9}[_nghost-%COMP%]   div.page-container[_ngcontent-%COMP%]   .left-side[_ngcontent-%COMP%]   .expander[disabled][_ngcontent-%COMP%]{pointer-events:none;opacity:.3}[_nghost-%COMP%]   div.page-container[_ngcontent-%COMP%]   .left-side[_ngcontent-%COMP%]   .expander[_ngcontent-%COMP%]   .expander-icon[_ngcontent-%COMP%]{font-size:16px}[_nghost-%COMP%]   div.page-container[_ngcontent-%COMP%]   .left-side[_ngcontent-%COMP%]   .expander[_ngcontent-%COMP%]   .expander-icon.flipped[_ngcontent-%COMP%]{transform:rotate(180deg)}}.narrow-mode[_nghost-%COMP%]   div.page-container[_ngcontent-%COMP%]{flex-direction:column}.narrow-mode[_nghost-%COMP%]   div.page-container[_ngcontent-%COMP%]   .left-side[_ngcontent-%COMP%]{box-shadow:2px 2px 4px 0 #9d9b99;flex:0 0 auto;height:13.25rem;width:100%;max-width:none;transition:height 50ms}.narrow-mode[_nghost-%COMP%]   div.page-container[_ngcontent-%COMP%]   .left-side.expanded[_ngcontent-%COMP%]{height:75%}.narrow-mode[_nghost-%COMP%]   div.page-container[_ngcontent-%COMP%]   .left-side[_ngcontent-%COMP%]   .expander[_ngcontent-%COMP%]{background-color:#3f4038;color:#fcfcf9;position:absolute;bottom:0;left:50%;transform:translateX(-50%);width:3.5rem;height:1rem;border:1px solid #8a9a5b;border-radius:5px 5px 0 0;text-align:center;display:flex;justify-content:center;cursor:pointer}.narrow-mode[_nghost-%COMP%]   div.page-container[_ngcontent-%COMP%]   .left-side[_ngcontent-%COMP%]   .expander[_ngcontent-%COMP%]:hover:not([disabled]){background-color:#4b5320;color:#fcfcf9}.narrow-mode[_nghost-%COMP%]   div.page-container[_ngcontent-%COMP%]   .left-side[_ngcontent-%COMP%]   .expander.active[_ngcontent-%COMP%]:not([disabled]){background-color:#708238;color:#fcfcf9}.narrow-mode[_nghost-%COMP%]   div.page-container[_ngcontent-%COMP%]   .left-side[_ngcontent-%COMP%]   .expander[disabled][_ngcontent-%COMP%]{pointer-events:none;opacity:.3}.narrow-mode[_nghost-%COMP%]   div.page-container[_ngcontent-%COMP%]   .left-side[_ngcontent-%COMP%]   .expander[_ngcontent-%COMP%]   .expander-icon[_ngcontent-%COMP%]{font-size:16px}.narrow-mode[_nghost-%COMP%]   div.page-container[_ngcontent-%COMP%]   .left-side[_ngcontent-%COMP%]   .expander[_ngcontent-%COMP%]   .expander-icon.flipped[_ngcontent-%COMP%]{transform:rotate(180deg)}[_nghost-%COMP%]   .page-container[_ngcontent-%COMP%]{height:100%;width:100%;display:flex}[_nghost-%COMP%]   .page-container[_ngcontent-%COMP%]   .left-side[_ngcontent-%COMP%]{position:relative;flex:1 1 0;overflow:hidden;max-width:27.5%;min-width:20rem}[_nghost-%COMP%]   .page-container[_ngcontent-%COMP%]   .left-side[_ngcontent-%COMP%]   .expander[_ngcontent-%COMP%]{display:none}[_nghost-%COMP%]   .page-container[_ngcontent-%COMP%]   .right-side[_ngcontent-%COMP%]{flex:1 1 0;overflow:auto;position:relative}[_nghost-%COMP%]   .left-side[_ngcontent-%COMP%]{background-color:#ddd9cf;display:flex;flex-direction:column}[_nghost-%COMP%]   .left-side[_ngcontent-%COMP%]   .control-button[_ngcontent-%COMP%]{flex:0 0 auto;background-color:#eae6da;min-width:2rem;padding:.25rem .5rem;font-size:1rem;cursor:pointer;text-align:center;outline:0;white-space:nowrap;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}[_nghost-%COMP%]   .left-side[_ngcontent-%COMP%]   .control-button[_ngcontent-%COMP%]:hover:not([disabled]){background-color:#bac39f}[_nghost-%COMP%]   .left-side[_ngcontent-%COMP%]   .control-button.active[_ngcontent-%COMP%]:not([disabled]){background-color:#708238;color:#fcfcf9}[_nghost-%COMP%]   .left-side[_ngcontent-%COMP%]   .control-button[disabled][_ngcontent-%COMP%]{pointer-events:none;opacity:.3}[_nghost-%COMP%]   .left-side[_ngcontent-%COMP%]   .file-explorer[_ngcontent-%COMP%]{flex:1 1 0}"]],data:{}});function x(e){return o.Nb(0,[(e()(),o.sb(0,0,null,null,12,"div",[["class","page-container"]],null,null,null,null,null)),(e()(),o.sb(1,0,null,null,8,"div",[["class","left-side"]],[[2,"expanded",null]],null,null,null,null)),(e()(),o.sb(2,0,null,null,1,"div",[["class","control-button"]],null,[[null,"click"]],(function(e,n,t){var o=!0;return"click"===n&&(o=!1!==e.component.onCreateSource()&&o),o}),null,null)),(e()(),o.Lb(-1,null,[" + New Source "])),(e()(),o.sb(4,0,null,null,1,"dwu-search-input",[],null,[[null,"searchTextChange"]],(function(e,n,t){var o=!0;return"searchTextChange"===n&&(o=!1!==(e.component.filterStr=t)&&o),o}),c.b,c.a)),o.rb(5,49152,null,0,l.a,[],{searchText:[0,"searchText"],placeholder:[1,"placeholder"]},{searchTextChange:"searchTextChange"}),(e()(),o.sb(6,0,null,null,3,"dwu-image-sources-explorer",[["class","file-explorer"]],null,[[null,"selectedImageSourceIdChange"]],(function(e,n,t){var o=!0;return"selectedImageSourceIdChange"===n&&(o=!1!==e.component.onSelectedImageSourceIdChange(t)&&o),o}),b,p)),o.rb(7,573440,null,0,f,[],{imageSources:[0,"imageSources"],filterStr:[1,"filterStr"],selectedImageSourceId:[2,"selectedImageSourceId"]},{selectedImageSourceIdChange:"selectedImageSourceIdChange"}),o.Fb(131072,C.b,[o.h]),o.Fb(131072,C.b,[o.h]),(e()(),o.sb(10,0,null,null,2,"div",[["class","right-side"]],null,null,null,null,null)),(e()(),o.sb(11,16777216,null,null,1,"router-outlet",[],null,null,null,null,null)),o.rb(12,212992,null,0,O.q,[O.b,o.O,o.j,[8,null],o.h],null,null)],(function(e,n){var t=n.component;e(n,5,0,t.filterStr,"search.."),e(n,7,0,o.Mb(n,7,0,o.Db(n,8).transform(t.imageSourcesList$)),t.filterStr,o.Mb(n,7,2,o.Db(n,9).transform(t.selectedImageSourceId$))),e(n,12,0)}),(function(e,n){e(n,1,0,n.component.leftSideExpanded)}))}function S(e){return o.Nb(0,[(e()(),o.Lb(-1,null,[" login\n"]))],null,null)}function v(e){return o.Nb(0,[(e()(),o.hb(16777216,null,null,2,null,x)),o.rb(1,16384,null,0,C.m,[o.O,o.L],{ngIf:[0,"ngIf"],ngIfElse:[1,"ngIfElse"]},null),o.Fb(131072,C.b,[o.h]),(e()(),o.hb(0,[["loginTemplate",2]],null,0,null,S))],(function(e,n){var t=n.component;e(n,1,0,o.Mb(n,1,0,o.Db(n,2).transform(t.user$)),o.Db(n,3))}),null)}function w(e){return o.Nb(0,[(e()(),o.sb(0,0,null,null,1,"dwu-image-sources",[],null,null,null,v,I)),o.rb(1,245760,null,0,P,[_.n,O.l,O.a],null,null)],(function(e,n){e(n,1,0)}),null)}var B=o.ob("dwu-image-sources",P,w,{},{},[]),y=t("PTyj"),F=t("gIcY"),k=t("0gVX"),T=t("trGy"),j=t("xpxz"),q=t("mrSG"),G=t("6blF"),N=t("67Y/"),D=(t("o0su"),function(){function e(e,n,t,o){this.firestore=e,this.storage=n,this.imageProcessing=t,this.exifService=o}return e.prototype.generateImageSourceToken=function(e){return q.__awaiter(this,void 0,void 0,(function(){return q.__generator(this,(function(n){switch(n.label){case 0:return[4,window.firebase.functions().httpsCallable("generateImageSourceTokenTask")({imageSourceId:e})];case 1:return[2,n.sent()]}}))}))},e.prototype.deleteFile=function(e){return q.__awaiter(this,void 0,void 0,(function(){return q.__generator(this,(function(n){switch(n.label){case 0:return[4,this.storage.deleteFile(e)];case 1:return n.sent(),[4,this.firestore.unregisterFile(e)];case 2:return[2,n.sent()]}}))}))},e.prototype.uploadImageSourceFile=function(e,n,t){return q.__awaiter(this,void 0,void 0,(function(){var o,r,i,a,c,l,s;return q.__generator(this,(function(u){switch(u.label){case 0:return[4,this.exifService.getExifData(e)];case 1:return o=u.sent(),r=this.exifService.getLocationData(o),i={userId:n.uid,fileName:e.name,isUploaded:!1,sourceId:t,locationData:q.__assign({},r)},[4,this.firestore.insertUploadDoc(i)];case 2:return a=u.sent(),c=q.__assign({},i,{id:a.id}),[4,this.imageProcessing.processImageFile(e,o)];case 3:return l=u.sent(),[4,this.storage.uploadFile(l,c.id)];case 4:return[4,u.sent().ref.getDownloadURL()];case 5:return s=u.sent(),[4,this.firestore.registerFileUploaded(c.id,{downloadUrl:s})];case 6:return[2,u.sent()]}}))}))},e.prototype.updateImageSource=function(e,n){return this.firestore.db.collection("imageSources").doc(e).update(n)},e.prototype.loadImageSourceTokens=function(e){var n=this;return G.a.create((function(t){return n.firestore.db.collection("imageSources").doc(e).collection("accessTokens").orderBy("createdAt","desc").onSnapshot(t)})).pipe(Object(N.a)((function(e){return e.docs.map((function(e){return q.__assign({},e.data(),{id:e.id})}))})))},e}()),R=t("GrFz"),z=t("cxyc"),L=t("YDhq"),U=t("T2NM"),A=t("7bNT"),V=t("ntSj"),E=t("O0RR"),Y=t("FE7n"),$=t("Rkte"),J=t("mRcA"),Q=t("R7F0"),W=t("a6Df"),X=t("Fzqc"),Z=t("dWZg"),H=t("qAlS"),K=t("FdjG"),ee=function(){return function(){}}(),ne=function(){return t.e(23).then(t.bind(null,"4Wog")).then((function(e){return e.ImageSourceIntroModuleNgFactory}))},te=function(){return t.e(26).then(t.bind(null,"9Vr9")).then((function(e){return e.ImageSourceViewModuleNgFactory}))},oe=function(){return function(){}}(),re=t("3A+F"),ie=t("jG/M"),ae=t("Ql0z"),ce=t("W61y");t.d(n,"ImageSourcesModuleNgFactory",(function(){return le}));var le=o.pb(r,[],(function(e){return o.Ab([o.Bb(512,o.j,o.ab,[[8,[i.a,a.a,B,y.b]],[3,o.j],o.w]),o.Bb(4608,C.o,C.n,[o.t,[2,C.A]]),o.Bb(4608,F.r,F.r,[]),o.Bb(135680,k.a,k.a,[o.j,o.g,o.q]),o.Bb(4608,T.a,T.a,[]),o.Bb(4608,j.a,j.a,[]),o.Bb(4608,D,D,[j.a,R.a,z.a,L.a]),o.Bb(4608,U.a,U.a,[_.n,A.a,j.a,D,O.l]),o.Bb(1073742336,C.c,C.c,[]),o.Bb(1073742336,F.q,F.q,[]),o.Bb(1073742336,F.h,F.h,[]),o.Bb(1073742336,V.a,V.a,[]),o.Bb(1073742336,E.a,E.a,[]),o.Bb(1073742336,Y.a,Y.a,[]),o.Bb(1073742336,$.a,$.a,[]),o.Bb(1073742336,J.a,J.a,[]),o.Bb(1073742336,Q.a,Q.a,[]),o.Bb(1073742336,W.a,W.a,[]),o.Bb(1073742336,u.b,u.b,[]),o.Bb(1073742336,X.a,X.a,[]),o.Bb(1073742336,Z.b,Z.b,[]),o.Bb(1073742336,H.h,H.h,[]),o.Bb(1073742336,K.a,K.a,[]),o.Bb(1073742336,ee,ee,[]),o.Bb(1073742336,O.p,O.p,[[2,O.u],[2,O.l]]),o.Bb(1073742336,oe,oe,[]),o.Bb(1073742336,re.a,re.a,[]),o.Bb(1073742336,ie.a,ie.a,[]),o.Bb(1024,_.O,(function(){return[{}]}),[]),o.Bb(1024,_.j,(function(){return[{key:"imageSources",reducerFactory:_.s,metaReducers:[],initialState:void 0}]}),[]),o.Bb(1024,_.P,_.W,[o.q,_.O,_.j]),o.Bb(1024,_.N,(function(){return[ae.a]}),[]),o.Bb(1024,_.Q,(function(e){return[e]}),[_.N]),o.Bb(1024,_.b,(function(e,n,t){return[_.X(e,n,t)]}),[o.q,_.N,_.Q]),o.Bb(1024,_.U,(function(e){return[_.H(e)]}),[_.T]),o.Bb(1073873408,_.o,_.o,[_.P,_.b,_.g,_.p,[2,_.U]]),o.Bb(1024,A.p,(function(){return[[U.a]]}),[]),o.Bb(1024,A.g,(function(){return[[]]}),[]),o.Bb(1024,A.q,(function(e,n,t){return[A.k(e,n,t)]}),[o.q,A.p,A.g]),o.Bb(1073742336,A.d,A.d,[A.e,A.q,[2,_.p],[2,_.o]]),o.Bb(1073742336,r,r,[]),o.Bb(1024,O.j,(function(){return[[{path:"",component:P,children:[{path:"intro",loadChildren:ne},{path:":imageSourceId",loadChildren:te},{path:"",pathMatch:"full",redirectTo:"intro"}]},{path:"",pathMatch:"full",redirectTo:"intro"}],[{path:"auth",component:ce.a},{path:"auth-success",component:ce.a}]]}),[])])}))},o0su:function(e,n,t){"use strict";t("trGy"),t("GrFz"),t("xpxz"),t("YDhq"),t("cxyc")}}]);